<!DOCTYPE html>
<html lang="en">

<head>
    <title>Free Open-Source Invoicing, Expenses &amp; Time-Tracking | Invoice Ninja</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="referrer" content="always">
    <link rel="canonical" href="https://invoiceninja.github.io/docs/self-host-troubleshooting">
    <meta name="description" content="The leading free open-source online invoicing app for freelancers &amp; businesses. Invoice, accept payments, track expenses, create proposals, &amp; time-tasks">

    <link rel="stylesheet" href="/assets/build/css/main.css?id=33c819d708c26c9fb990">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

        <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/agate.min.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>

    <script>hljs.highlightAll();</script>
</head>

<nav class="py-4 sticky top-0 z-40 lg:z-50 w-full mx-auto bg-white border-b">
    <div id="navigation-content" class="flex items-center justify-between px-4 md:px-0 md:mx-4 lg:px-4 xl:mx-auto max-w-8xl">
        <a href="/" id="left-side-logo">
            <img class="h-8"
                 src="/assets/images/logo.png"
                 alt="Invoice Ninja logo"/>
        </a>
        <section id="right-side-items" class="text-sm">
            <div class="hidden md:hidden lg:block md:space-x-5">
                <input type="text" placeholder="Quick search ..." id="topSearchBox"
                       class="pb-1 border-b hover:border-ninja-blue focus:border-ninja-blue focus:outline-none">
                <a href="/docs/getting-started" class="py-2 border-b border-transparent hover:border-ninja-blue">Documentation</a>
                <a href="https://app.swaggerhub.com/apis/invoiceninja/invoiceninja" target="_blank"
                   class="py-2 border-b border-transparent hover:border-ninja-blue">API Documentation</a>
                <a href="https://app.invoiceninja.com" class="px-5 py-2 border rounded-full hover:border-ninja-blue">Go
                    to app</a>
            </div>
            <div class="flex flex-col lg:hidden">
                <button id="mobile-menu-toggle" class="focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                         class="feather feather-menu">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
            </div>
        </section>
    </div>
    <div id="mobile-menu" class="hidden px-4 pt-4 flex flex-col">
        <a href="/docs/getting-started"
           class="py-2 border-b border-transparent hover:border-ninja-blue">Documentation</a>
        <a href="https://app.swaggerhub.com/apis/invoiceninja/invoiceninja" target="_blank"
           class="py-2 border-b border-transparent hover:border-ninja-blue">API Documentation</a>
        <a href="https://app.invoiceninja.com" target="_blank"
           class="py-2 border-b border-transparent hover:border-ninja-blue">Go to app</a>
    </div>
</nav>
<body class="font-sans antialiased text-gray-900 bg-white ">
        <div class="hidden top-0 absolute z-40 bg-white w-full h-screen" id="mobile-menu-overlay">
       <div class="p-6 flex items-top justify-between">
           <div>
                                  <div clasS="mb-8">
                       <a class="block hover:text-ninja-blue font-semibold uppercase "
                          href="/docs/getting-started">User guide</a>

                       <div class="mt-2">
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/introduction">Introduction</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/clients">Clients</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/invoices">Invoices</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/recurring-invoices">Recurring Invoices</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/subscriptions">Subscriptions</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/settings">Settings</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/custom-fields">PDF customization</a>
                                                  </div>
                   </div>
                                  <div clasS="mb-8">
                       <a class="block hover:text-ninja-blue font-semibold uppercase "
                          href="/docs/developer-guide">Developer guide</a>

                       <div class="mt-2">
                                                  </div>
                   </div>
                                  <div clasS="mb-8">
                       <a class="block hover:text-ninja-blue font-semibold uppercase "
                          href="/docs/self-host-installation">Self host</a>

                       <div class="mt-2">
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/self-host-installation">Installation</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/self-host-updating">Updating</a>
                                                          <a class="block hover:text-ninja-blue py-1 text-ninja-blue"
                                  href="/docs/self-host-troubleshooting">Troubleshooting</a>
                                                  </div>
                   </div>
                                  <div clasS="mb-8">
                       <a class="block hover:text-ninja-blue font-semibold uppercase "
                          href="/docs/migration">Migrating to V5</a>

                       <div class="mt-2">
                                                  </div>
                   </div>
                                  <div clasS="mb-8">
                       <a class="block hover:text-ninja-blue font-semibold uppercase "
                          href="">Legal</a>

                       <div class="mt-2">
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/legal/terms_of_service">Terms of Service</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/legal/data_privacy">Data Privacy</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/legal/self_hosting_data">Selfhost Data Privacy</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/legal/self_hosting_terms">Selfhost Terms</a>
                                                          <a class="block hover:text-ninja-blue py-1 "
                                  href="/docs/legal/gdpr">GDPR</a>
                                                  </div>
                   </div>
                          </div>
           <div>
                <button onclick="document.getElementById('mobile-menu-overlay').classList.add('hidden');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
           </div>
       </div>
    </div>

    <div class="max-w-8xl grid grid-cols-12 md:gap-16 py-4 px-4 lg:mx-auto">
        <div class="hidden mr-4 space-y-6 md:block lg:col-span-2">
            <div class="hidden lg:block fixed mt-2 h-full overflow-y-auto pb-32 pr-10">
                                    <div clasS="mb-8">
                        <a class="block hover:text-ninja-blue font-semibold uppercase "
                           href="/docs/getting-started">User guide</a>

                        <div class="mt-2">
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/introduction">Introduction</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/clients">Clients</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/invoices">Invoices</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/recurring-invoices">Recurring Invoices</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/subscriptions">Subscriptions</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/settings">Settings</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/custom-fields">PDF customization</a>
                                                    </div>
                    </div>
                                    <div clasS="mb-8">
                        <a class="block hover:text-ninja-blue font-semibold uppercase "
                           href="/docs/developer-guide">Developer guide</a>

                        <div class="mt-2">
                                                    </div>
                    </div>
                                    <div clasS="mb-8">
                        <a class="block hover:text-ninja-blue font-semibold uppercase "
                           href="/docs/self-host-installation">Self host</a>

                        <div class="mt-2">
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/self-host-installation">Installation</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/self-host-updating">Updating</a>
                                                            <a class="block hover:text-ninja-blue py-1 text-ninja-blue"
                                   href="/docs/self-host-troubleshooting">Troubleshooting</a>
                                                    </div>
                    </div>
                                    <div clasS="mb-8">
                        <a class="block hover:text-ninja-blue font-semibold uppercase "
                           href="/docs/migration">Migrating to V5</a>

                        <div class="mt-2">
                                                    </div>
                    </div>
                                    <div clasS="mb-8">
                        <a class="block hover:text-ninja-blue font-semibold uppercase "
                           href="">Legal</a>

                        <div class="mt-2">
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/legal/terms_of_service">Terms of Service</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/legal/data_privacy">Data Privacy</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/legal/self_hosting_data">Selfhost Data Privacy</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/legal/self_hosting_terms">Selfhost Terms</a>
                                                            <a class="block hover:text-ninja-blue py-1 "
                                   href="/docs/legal/gdpr">GDPR</a>
                                                    </div>
                    </div>
                            </div>
        </div> <!-- End of sidebar -->

        <div class="col-span-12 md:col-span-7 p-4 prose mx-auto" style="max-width: 100% !important;" id="page-content">
            <div class="block lg:hidden flex flex-col mb-4 lg:mb-0">
                <button onclick="document.getElementById('mobile-menu-overlay').classList.remove('hidden');">&#8592; Documentation</button>
            </div>

            <h1>Troubleshooting</h1>

<h2>PDFs don't appear to be updating</h2>

<p>If you are using Cloudflare, then most likely Cloudflare could be caching your static data. To force cache busting, edit your nginx.conf file and add in the following snippet</p>

<pre><code class="language-bash">location ~* \.pdf$ {
    add_header Cache-Control no-store;
}
</code></pre>

<h2>Email not sending</h2>

<p>If you are experiencing issues sending emails be sure to double check your .env file contains the correct fields configured.</p>

<pre><code>MAIL_MAILER=smtp
MAIL_HOST=localhost
MAIL_PORT=1025
MAIL_USERNAME='email@gmail.com'
MAIL_PASSWORD='supersecretpassword'
MAIL_ENCRYPTION='tls'
</code></pre>

<p> <div class="p-5 bg-gray-200 border-l-4 border-red-500">
    <span>If you are using Gmail - ensure you have less secure apps turned on.</span>
</div> </p>

<p>If you are using gmail smtp relay, then a additional .env variable is required.</p>

<pre><code>SERVER_NAME=
</code></pre>

<p>Emails will fail with the message:</p>

<pre><code>Expected response code 250 but got an empty response
</code></pre>

<p>without this additional field.</p>

<p>The <code>MAIL_MAILER</code> field defines which email driver you wish to use, this could be postmark, maildriver, smtp - anything that Laravel 8 support natively is supported in this app.</p>

<p>If the mail config is correct, the next place to check would be to check the error logs for any errors that are being thrown, the error log is found in <code>storage/logs/laravel.log</code></p>

<p>The final source of information in diagnosing mail troubles is to inspect the <code>System Logs</code> tab in the dashboard of the application, in here we log any messages from the mail server itself which may be instructive as to the cause of your issues.</p>

<p>If you are using the Queue system ie. QUEUE_CONNECTION=database then you may also want to check the <code>jobs</code> table in the database, there should be <em>no</em> records in that table... If there are records in the table it means that your queue is not running and therefore no mail jobs are being processed.</p>

<p>It's possible the emails are sent but are blocked for DNS, SPF, DKIM or other reasons. In these cases emailing a test invoice to <a href="https://mail-tester.com">mail-tester.com</a> can help debug certain problems.</p>

<h2>PDF conversion issues.</h2>

<p>We strongly recommend using the built in <a href="https://github.com/beganovich/snappdf">snappdf</a> package which is a highly performant PDF generator based on the headless chrome/chromium binary. This package is perfect for users that have root access to their server and are able to install the required dependencies if needed.</p>

<p>Snappdf is also the default PDF engine in our <a href="https://github.com/invoiceninja/dockerfiles">Docker</a> image, so if you prefer a very simple installation please consider our Docker setup as it is very fast to get going!</p>

<p>If you are on shared hosting, snappdf probably will be impossible for you to use as you do not have access to the subsystem to install the required packages. Instead, you will need to use a hosted PDF service, the two that Invoice Ninja v5 supports is <a href="https://phantomjscloud.com/">PhantomJS Cloud</a> and our own hosted PDF generator that users with a white label license can use for <em>free</em> to generate <em>unlimited</em> PDFs.</p>

<h3>Phantom JS</h3>

<p>Phantom JS Cloud is the default PDF engine <a href="https://phantomjscloud.com/">PhantomJS Cloud</a> to generate your PDFs, the default API key that comes with a clean installation can generate 100 PDFs per day. If you register for an API key, you will be able to generate 500 PDFs per day, which should suit most users.</p>

<p>Phantom JS can be toggled on and off by setting the PHANTOMJS_PDF_GENERATOR to either TRUE or FALSE. The following .env variables are available for configuring PhantomJS.</p>

<pre><code class="language-bash">PHANTOMJS_PDF_GENERATION=true
PHANTOMJS_KEY='a-demo-key-with-low-quota-per-ip-address'
PHANTOMJS_SECRET='your-secret-here'
</code></pre>

<p>Once this has been done you'll need to refresh the config cache:</p>

<pre><code class="language-bash">php artisan optimize
</code></pre>

<p>If you experience errors with PDF generation, such as <code>500 Server error</code> or <code>Failed to load PDF document</code> or a continuous loading bar, try getting a PhantomJS key <a href="https://dashboard.phantomjscloud.com/dash.html#/signup">here</a>, Replace it with the prefilled key <code>a-demo-key-with-low-quota-per-ip-address</code> and run <code>php artisan optimize</code> again.</p>

<p> <div class="p-5 bg-gray-200 border-l-4 border-red-500">
    <span>For PhantomJS to work, your Invoice Ninja installation web address must be public; localhost installations or those on private networks won't be able to use PhantomJS Cloud.</span>
</div> </p>

<h3>Hosted Invoice Ninja PDF generation</h3>

<p>If you are a white label user, then to enable the Invoice Ninja hosted PDF generator you will need to add a variable to the .env file as follows</p>

<pre><code>NINJA_HOSTED_PDF=true
</code></pre>

<p>You will also need to turn OFF PhantomJS cloud</p>

<pre><code>PHANTOMJS_PDF_GENERATION=false
</code></pre>

<p> <div class="p-5 bg-gray-200 border-l-4 border-red-500">
    <span>Don't forget to refresh your cache (not needed for shared hosting!) with php artisan optimize</span>
</div> </p>

<h2>Cron not running / Queue not running</h2>

<p>If you are faced with your recurring invoices not firing, or your reminders not sending, then most likely your cron job isn't working. The first thing is to make sure you have your cron jobs configured correctly by following the guide <a href="https://invoiceninja.github.io/docs/self-host-installation/#cron-configuration-1">here</a></p>

<p>If you are using shared hosting, then will need to add an additional parameter to the cron command which looks like this:</p>

<pre><code>cd /path/to/root/folder &amp;&amp; /usr/bin/php -d register_argc_argv=On artisan schedule:run &gt;&gt; /dev/null 2&gt;&amp;1
</code></pre>

<h2>Platform specific issues</h2>

<h3>General advice</h3>

<p>When facing errors, first set <code>APP_DEBUG=true</code> in <code>.env</code> and execute <code>php artisan optimize</code> to get more extensive debug information.</p>

<h3>Erroneous data format for unserializing 'Symfony\Component\Routing\CompiledRoute'</h3>

<p>The most common cause of this issue is running multiple version of PHP, if the caches are built with a different version of PHP you may see the above error as differing versions of PHP may not be interoperable on the same installation. Ensure you are running the same CLI and Web PHP version to prevent any errors/</p>

<h3>Unable to connect to database after installation</h3>

<p>You may need to restart the queue like this</p>

<pre><code class="language-bash">php artisan queue:restart
</code></pre>

<h3>Nginx: 413 – Request Entity Too Large</h3>

<p>This error indicated that the client_max_body_size parameter in NGINX is too small, you will need to edit your nginx config and increase the size</p>

<pre><code class="language-bash">client_max_body_size 100M;
</code></pre>

<h3>Proxy configuration.</h3>

<p>For users that rely on configuring a reverse proxy, please consider this post on our forum which details steps which may assist in configuring a reverse proxy.</p>

<p><a href="https://forum.invoiceninja.com/t/selfhosting-setup-failing/5651/8">Reverse Proxy Invoice Ninja</a></p>

<h3>Problems with migration</h3>

<p>If you are experiencing issues with the migration not running as expected please run through the following checklist:</p>

<ul>
<li>Ensure directories are read/writable by the webuser (ie www-data)</li>
<li>Ensure the cron scheduler is running (and working) - You can verify it is working by inspecting the <code>jobs</code> table in the database, it should be empty</li>
<li>Inspect the log file /storage/logs/laravel.log for further information.</li>
<li>If you are still experiencing issues, turn on advanced logging by adding the following variable to your .env file. <code>EXPANDED_LOGGING=true</code> then optimize with <code>php artisan optimize</code> . Then attempt the migration again and afterwards inspect the log file in storage/logs/invoiceninja.log</li>
</ul>

<h3>libatk.so not loading for Google</h3>

<p>Pdf generation will not working using the inbuilt PDF engine without some subsystem dependencies, please consult this resource for the list of necessary libraries for each supported platform <a href="https://github.com/beganovich/snappdf#headless-chrome-doesnt-launch-on-unix">Snappdf required libraries</a></p>

<h3>WebCron configuration</h3>

<p>Some systems do not allow cron configurations, one work around is to use a web cron service which can hit a defined endpoint which executes the scheduler via a GET HTTP request. Invoice Ninja has implemented a small service to allow a webcron service to hit the end point:</p>

<pre><code>https://domain.com/webcron?secret=
</code></pre>

<p>To configure the service, you need to add a .env variable</p>

<pre><code>WEBCRON_SECRET=password
</code></pre>

<p>Define your own secret password and then re optimize the cache The service will then be activated.</p>

<h3>Installing in a subdirectory.</h3>

<p>It is possible to install Invoice Ninja in a subdirectory outside the doc root, to enable this you will need to update the .htaccess file (only if you are using the Apache webserver),</p>

<pre><code class="language-php">RewriteRule ^(.*)$ public/$1 [L]
</code></pre>

<p>should be updated to</p>

<pre><code class="language-php">RewriteRule ^(.*)$ subdirectoryname/public/$1 [L]
</code></pre>

<h3>Endless setup loop</h3>

<p>If you are finding that all your pre setup checks are passing however you keep falling back to the setup screen, this could indicate that you are missing the <code>mysql-client</code> library which is needed to perform the initial migration. If you are unable to install this for some reason (ie. XAMPP) then you'll need to run the migrations manually by entering the following at the command prompt</p>

<pre><code>php artisan migrate:fresh --seed 
</code></pre>

<h3>flock() expects parameter 1 to be resource, bool given</h3>

<p>This error is thrown from deep within PHP and indicates a permissions issue - most likely the public/storage and/or storage/ directory is not writable by the web user, depending on your platform, you'll need to run something like:</p>

<pre><code>sudo chown -R www-data:www-data public/storage
</code></pre>

<p>and/or</p>

<pre><code>sudo chown -R www-data:www-data storage/
</code></pre>

<h3>Unresponsive UI</h3>

<p>If for some reason the UI becomes unresponsive, you may need to flush some subsystem configuration and rebuild. It is possible to do this by navigating to the <code>/update?secret=</code>  route, ie. https://invoiceninja.test/update?secret= This will perform a number of system clean ups and may resolve issues resulting from an incomplete upgrade. To protect this route, you are advised to add a .env pararameter <code>UPDATE_SECRET=a_secret_passcode</code> this will restrict the route to users with the UPDATE_SECRET passcode.</p>

            <a href="https://github.com/invoiceninja/invoiceninja.github.io/blob/v5-rework/source/docs/self-host-troubleshooting.md"
               class="pt-4 border-t inline-flex items-center w-full block">
                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                     class="feather feather-github">
                    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                </svg>
                <span class="ml-2">Want to contribute? Edit this page on GitHub!</span>
            </a>
        </div> <!-- End of main content -->

        <div class="hidden md:block col-span-3 p-4">
            <div class="fixed overflow-y-auto pr-10 h-full pb-32" id="toc-container">
                <!-- Placeholder for table of contents -->
                <span class="text-sm uppercase block mb-3 text-ninja-blue">On this page</span>
            </div>
        </div>
    </div>
        <script src="/assets/build/js/main.js?id=f8ae428c8ff7fbb77216"></script>

    <script>
        document.getElementById('mobile-menu-toggle').addEventListener('click', () => {
            let mobileMenu = document.getElementById('mobile-menu');

            if (mobileMenu.classList.contains('hidden')) {
                return mobileMenu.classList.remove('hidden');
            }

            return mobileMenu.classList.add('hidden');
        });
    </script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script type="text/javascript">
        docsearch({
            apiKey: '4816218e8381d5a17beacd84823e9ea3',
            indexName: 'invoiceninja',
            inputSelector: '#topSearchBox',
            debug: false
        });
    </script>
</body>

</html>
